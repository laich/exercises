public class Solution {
   public static int candy(int[] ratings) {
	        if(ratings.length<=1)
	            return 1;
	        int offsetStart=1;
	        int offsetEnd=offsetStart+1;
	        int total=0;
	        int priorAssigned=1;
	        int lastOneAmount=1;
	        int gap=0;
	        boolean isEqualsBefore=false;
	        if(ratings[1]<ratings[0])
	            total=1;
	        for(int i=1;i<ratings.length;i++){
	            if(ratings[i]<ratings[i-1]){
	                if(1==offsetEnd-offsetStart&&!isEqualsBefore){
	                    total+=priorAssigned;
	                    offsetEnd++;
	                    gap=priorAssigned-1;
	                }else if(isEqualsBefore){
	                    total++;
	                    total+=(offsetEnd++-offsetStart);
	                }
	                else{
	                    if(gap<offsetEnd-offsetStart)
	                    	total++;
	                    total+=(offsetEnd++-offsetStart);
	                }
	                priorAssigned=1;
	                lastOneAmount=1;
	                isEqualsBefore=false;
	            }else if(ratings[i]==ratings[i-1]){
	                if(isEqualsBefore){
	                    total++;                       
	                }
	                else
	                    total+=priorAssigned; 
	                priorAssigned=1;
	                lastOneAmount=1;
	                offsetStart=offsetEnd++;
	                isEqualsBefore=true;
	                gap=0;
	            }else{
	                gap=0;
	                total+=priorAssigned;
	                offsetStart=offsetEnd++;
	                priorAssigned++;
	                lastOneAmount=priorAssigned;
	                isEqualsBefore=false;
	            }
	        }
	       
	            return total+lastOneAmount;
	    }
}
